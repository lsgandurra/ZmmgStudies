#include "rochcor_v2.h"
#include <TLorentzVector.h>


const float rochcor::netabin[9] = {-2.4,-2.1,-1.4,-0.7,0.0,0.7,1.4,2.1,2.4};

const float rochcor::dcor_bf[8][8]={{-0.000158627,-0.000041007,0.000043624,-0.000091272,-0.000034110,0.000006713,-0.000080008,-0.000194434},
				    {0.000241518,0.000072115,0.000027533,0.000007656,0.000034291,0.000041096,-0.000074288,0.000195368},
				    {0.000017460,-0.000041965,0.000000277,0.000036683,0.000066782,-0.000026871,-0.000068934,0.000010328},
				    {-0.000207442,-0.000049851,0.000019875,-0.000055971,-0.000046222,-0.000029831,-0.000007562,0.000018155},
				    {-0.000036763,-0.000005644,0.000047856,0.000032626,0.000013827,-0.000072283,-0.000094405,0.000050860},
				    {-0.000094939,-0.000131366,-0.000075372,0.000032292,0.000019199,-0.000045545,-0.000086305,0.000063140},
				    {-0.000130517,-0.000072986,-0.000046152,0.000015208,0.000009953,-0.000005145,-0.000122427,-0.000147232},
				    {-0.000102185,-0.000138366,0.000028924,0.000056669,0.000004343,-0.000016539,-0.000081825,-0.000034028}};

const float rochcor::dcor_ma[8][8]={{0.000805474,0.000095680,-0.000121130,-0.000149714,-0.000015070,-0.000114498,0.000410759,0.001487961},
				    {0.001331066,0.000255781,-0.000055927,-0.000137388,-0.000104651,-0.000027939,0.000186082,0.000423447},
				    {0.000348590,0.000179236,0.000066083,0.000110454,0.000052145,0.000093023,0.000161062,0.000340619},
				    {-0.001415117,-0.000394094,0.000083846,0.000147743,0.000160102,0.000123075,0.000004976,0.000207911},
				    {-0.002134604,-0.000408886,0.000083859,0.000007377,0.000108943,0.000275153,0.000146330,-0.000460230},
				    {-0.001523571,-0.000437942,-0.000053675,-0.000025232,-0.000030116,0.000001054,0.000022751,-0.000233307},
				    {0.000050689,-0.000169297,-0.000014999,-0.000054801,-0.000054433,-0.000114541,-0.000080054,0.001299430},
				    {0.000111760,-0.000062912,-0.000073251,-0.000084647,-0.000166647,-0.000204877,0.000075218,0.001616720}};

const float rochcor::mcor_bf[8][8]={{-0.000081183,-0.000032454,-0.000005871,0.000007079,0.000001851,-0.000004238,-0.000056003,-0.000069144},
				    {-0.000044702,-0.000038374,-0.000006697,-0.000003170,-0.000004404,-0.000009617,-0.000029945,-0.000050143},
				    {-0.000035333,-0.000038739,-0.000004194,-0.000006795,-0.000004931,-0.000015930,-0.000042579,-0.000079745},
				    {-0.000061599,-0.000025799,-0.000005719,-0.000002640,-0.000000929,-0.000005627,-0.000025918,-0.000074682},
				    {-0.000058763,-0.000011336,0.000004742,0.000005024,0.000006627,0.000001016,-0.000028923,-0.000062475},
				    {-0.000016707,-0.000019082,0.000002928,0.000009460,0.000013846,-0.000002118,-0.000024903,-0.000055974},
				    {-0.000086730,-0.000034314,-0.000003279,0.000011301,0.000009881,0.000004204,-0.000027995,-0.000038818},
				    {-0.000081023,-0.000036121,-0.000003035,0.000005324,0.000006723,0.000005482,-0.000017715,-0.000047703}};

const float rochcor::mcor_ma[8][8]={{0.000970838,0.000139735,-0.000155523,-0.000165159,-0.000167829,-0.000201043,0.000033471,0.000144333},
				    {0.001070522,-0.000007067,-0.000115133,-0.000109028,-0.000096448,-0.000054779,0.000214628,0.000761522},
				    {0.000524460,-0.000038304,0.000020823,0.000019881,0.000023338,0.000063761,0.000077257,0.000025121},
				    {0.000705021,0.000404796,0.000183250,0.000143252,0.000135090,0.000150297,0.000305635,0.000304913},
				    {0.000851140,0.000517764,0.000200686,0.000167664,0.000156614,0.000165996,0.000341491,0.000956935},
				    {-0.001249572,-0.000162622,0.000102779,0.000097324,0.000102674,0.000069528,0.000149003,0.000803922},
				    {-0.001756149,-0.000317027,-0.000025581,-0.000016768,-0.000025672,-0.000045368,-0.000138805,-0.000195686},
				    {0.000399741,0.000114320,-0.000130493,-0.000119224,-0.000126619,-0.000154748,-0.000785540,-0.002172797}};


const float rochcor::dcor_bfer[8][8]={{7.37473e-05,3.75889e-05,3.20022e-05,2.9911e-05,3.01223e-05,3.22157e-05,3.82172e-05,7.03758e-05},
				      {6.75187e-05,3.74405e-05,3.19017e-05,2.9935e-05,2.99122e-05,3.22002e-05,3.74623e-05,6.74052e-05},
				      {6.99395e-05,3.84822e-05,3.2085e-05,2.96944e-05,2.97413e-05,3.18173e-05,3.75743e-05,6.78304e-05},
				      {6.84729e-05,3.78376e-05,3.16608e-05,3.02723e-05,2.99409e-05,3.20239e-05,3.71136e-05,6.75503e-05},
				      {6.95875e-05,3.77259e-05,3.22479e-05,2.96892e-05,2.98704e-05,3.22171e-05,3.8213e-05,7.30092e-05},
				      {6.6844e-05,3.71637e-05,3.15039e-05,3.06548e-05,3.024e-05,3.17404e-05,3.70623e-05,6.76387e-05},
				      {7.00723e-05,3.78952e-05,3.17033e-05,3.00575e-05,3.03775e-05,3.17243e-05,3.72027e-05,6.85466e-05},
				      {6.89302e-05,3.8021e-05,3.20179e-05,2.98126e-05,2.99747e-05,3.17361e-05,3.7777e-05,6.74314e-05}};

const float rochcor::dcor_maer[8][8]={{7.37473e-05,3.75889e-05,3.20022e-05,2.9911e-05,3.01223e-05,3.22157e-05,3.82172e-05,7.03758e-05},
				      {6.75187e-05,3.74405e-05,3.19017e-05,2.9935e-05,2.99122e-05,3.22002e-05,3.74623e-05,6.74052e-05},
				      {6.99395e-05,3.84822e-05,3.2085e-05,2.96944e-05,2.97413e-05,3.18173e-05,3.75743e-05,6.78304e-05},
				      {6.84729e-05,3.78376e-05,3.16608e-05,3.02723e-05,2.99409e-05,3.20239e-05,3.71136e-05,6.75503e-05},
				      {6.95875e-05,3.77259e-05,3.22479e-05,2.96892e-05,2.98704e-05,3.22171e-05,3.8213e-05,7.30092e-05},
				      {6.6844e-05,3.71637e-05,3.15039e-05,3.06548e-05,3.024e-05,3.17404e-05,3.70623e-05,6.76387e-05},
				      {7.00723e-05,3.78952e-05,3.17033e-05,3.00575e-05,3.03775e-05,3.17243e-05,3.72027e-05,6.85466e-05},
				      {6.89302e-05,3.8021e-05,3.20179e-05,2.98126e-05,2.99747e-05,3.17361e-05,3.7777e-05,6.74314e-05}};

const float rochcor::mcor_bfer[8][8]={{4.14432e-05,2.20988e-05,1.872e-05,1.71647e-05,1.73018e-05,1.90136e-05,2.27066e-05,4.05287e-05},
				      {3.95907e-05,2.21115e-05,1.8984e-05,1.73846e-05,1.73801e-05,1.8959e-05,2.23286e-05,3.94786e-05},
				      {3.97194e-05,2.22952e-05,1.89242e-05,1.73341e-05,1.72628e-05,1.89584e-05,2.21094e-05,3.95818e-05},
				      {3.94978e-05,2.23022e-05,1.88035e-05,1.72174e-05,1.71863e-05,1.88068e-05,2.20723e-05,3.95353e-05},
				      {3.9916e-05,2.21984e-05,1.88392e-05,1.71723e-05,1.71486e-05,1.89526e-05,2.2952e-05,4.14933e-05},
				      {3.95489e-05,2.21262e-05,1.88112e-05,1.76387e-05,1.75442e-05,1.8814e-05,2.20633e-05,3.95207e-05},
				      {3.98739e-05,2.21045e-05,1.88703e-05,1.72723e-05,1.75426e-05,1.87692e-05,2.18787e-05,3.92996e-05},
				      {3.99943e-05,2.2487e-05,1.88157e-05,1.7182e-05,1.72385e-05,1.89273e-05,2.22099e-05,3.9295e-05}};

const float rochcor::mcor_maer[8][8]={{4.14432e-05,2.20988e-05,1.872e-05,1.71647e-05,1.73018e-05,1.90136e-05,2.27066e-05,4.05287e-05},
				      {3.95907e-05,2.21115e-05,1.8984e-05,1.73846e-05,1.73801e-05,1.8959e-05,2.23286e-05,3.94786e-05},
				      {3.97194e-05,2.22952e-05,1.89242e-05,1.73341e-05,1.72628e-05,1.89584e-05,2.21094e-05,3.95818e-05},
				      {3.94978e-05,2.23022e-05,1.88035e-05,1.72174e-05,1.71863e-05,1.88068e-05,2.20723e-05,3.95353e-05},
				      {3.9916e-05,2.21984e-05,1.88392e-05,1.71723e-05,1.71486e-05,1.89526e-05,2.2952e-05,4.14933e-05},
				      {3.95489e-05,2.21262e-05,1.88112e-05,1.76387e-05,1.75442e-05,1.8814e-05,2.20633e-05,3.95207e-05},
				      {3.98739e-05,2.21045e-05,1.88703e-05,1.72723e-05,1.75426e-05,1.87692e-05,2.18787e-05,3.92996e-05},
				      {3.99943e-05,2.2487e-05,1.88157e-05,1.7182e-05,1.72385e-05,1.89273e-05,2.22099e-05,3.9295e-05}};


//=======================================================================================================

const float rochcor::dmavg[8][8]={{0.025841654,0.025169854,0.025011206,0.025395838,0.025418225,0.025015774,0.025224683,0.025974429},
				  {0.025861489,0.025125329,0.025010353,0.025500707,0.025489963,0.025008537,0.025137030,0.025832796},
				  {0.025821408,0.025186450,0.025037872,0.025501346,0.025483008,0.025041506,0.025113340,0.025784026},
				  {0.025788934,0.025194992,0.025012688,0.025448230,0.025462702,0.025014923,0.025197164,0.025867098},
				  {0.025760288,0.025174665,0.025016407,0.025392482,0.025471408,0.025029052,0.025175578,0.025861644},
				  {0.025806517,0.025155944,0.025037512,0.025453861,0.025444491,0.025031604,0.025155092,0.025817768},
				  {0.025869055,0.025189694,0.025015786,0.025439865,0.025442569,0.025016054,0.025147406,0.025839110},
				  {0.025888792,0.025193920,0.025004796,0.025439635,0.025450924,0.025051811,0.025184476,0.025903766}};

const float rochcor::dpavg[8][8]={{0.025898904,0.025199348,0.025035358,0.025443318,0.025458991,0.025005425,0.025240268,0.025938705},
				  {0.025866088,0.025135635,0.024982141,0.025499841,0.025486708,0.025016742,0.025149977,0.025868440},
				  {0.025937212,0.025215783,0.025005637,0.025485235,0.025497530,0.025026424,0.025160232,0.025872083},
				  {0.026045614,0.025223491,0.025006442,0.025480239,0.025443261,0.025014746,0.025192345,0.026001787},
				  {0.026061459,0.025238992,0.024982766,0.025448465,0.025440474,0.025040136,0.025225223,0.025988278},
				  {0.025948545,0.025225443,0.025033229,0.025479361,0.025462158,0.025012956,0.025226031,0.025966973},
				  {0.025960053,0.025211227,0.025028419,0.025455877,0.025481075,0.025042283,0.025234109,0.025905996},
				  {0.025935873,0.025241859,0.025040274,0.025465336,0.025454850,0.025009889,0.025205653,0.025854941}};

const float rochcor::mmavg[8][8]={{0.025829786,0.025169473,0.025013846,0.025388393,0.025411355,0.025010805,0.025202152,0.025899664},
				  {0.025842260,0.025125429,0.025009772,0.025498847,0.025488838,0.025009478,0.025130944,0.025861163},
				  {0.025835888,0.025170311,0.025040208,0.025502037,0.025489045,0.025038262,0.025110804,0.025781080},
				  {0.025842419,0.025224742,0.025017573,0.025444446,0.025459245,0.025017168,0.025209678,0.025878395},
				  {0.025842973,0.025199329,0.025020778,0.025396703,0.025472987,0.025026565,0.025183608,0.025923479},
				  {0.025777123,0.025156465,0.025038525,0.025458770,0.025448435,0.025031274,0.025156820,0.025861010},
				  {0.025817883,0.025186268,0.025014042,0.025439804,0.025442149,0.025018050,0.025133750,0.025758674},
				  {0.025895147,0.025189016,0.025003572,0.025440494,0.025450122,0.025048328,0.025154201,0.025781366}};

const float rochcor::mpavg[8][8]={{0.025891062,0.025207169,0.025039901,0.025437318,0.025466886,0.025010214,0.025252711,0.025955304},
				  {0.025923372,0.025148689,0.024985494,0.025500826,0.025487326,0.025016959,0.025148572,0.025869497},
				  {0.025934660,0.025221729,0.025004507,0.025485006,0.025499493,0.025023891,0.025161419,0.025877950},
				  {0.025967738,0.025198407,0.025006250,0.025472374,0.025439397,0.025010166,0.025180818,0.025988669},
				  {0.025943425,0.025213365,0.024983108,0.025441826,0.025440607,0.025037579,0.025209857,0.025911656},
				  {0.025940407,0.025213463,0.025022946,0.025476588,0.025460014,0.025013135,0.025221339,0.025940310},
				  {0.026030080,0.025217061,0.025025315,0.025456126,0.025483171,0.025038431,0.025224331,0.025973260},
				  {0.025930178,0.025226172,0.025042930,0.025471031,0.025454989,0.025012659,0.025231461,0.026010900}};

// incremental correction on top of MuscleFit for data
const float rochcor::dcor_bf_muscle[8][8]={{-0.000162673,-0.000047589,0.000037021,-0.000095793,-0.000043765,-0.000006243,-0.000085774,-0.000201563},
					   {0.000231906,0.000065487,0.000025240,0.000002079,0.000028443,0.000032015,-0.000077682,0.000181189},
					   {0.000011939,-0.000048316,-0.000007489,0.000033570,0.000060447,-0.000030663,-0.000074522,0.000004253},
					   {-0.000218088,-0.000059305,0.000015492,-0.000064564,-0.000053931,-0.000036397,-0.000013343,0.000004081},
					   {-0.000042473,-0.000013249,0.000040576,0.000027629,0.000007762,-0.000077024,-0.000102740,0.000049941},
					   {-0.000105152,-0.000139022,-0.000078581,0.000027723,0.000012002,-0.000047076,-0.000089156,0.000054303},
					   {-0.000140662,-0.000080183,-0.000046946,0.000008813,0.000001821,-0.000011909,-0.000126726,-0.000155634},
					   {-0.000119202,-0.000146354,0.000022223,0.000050348,-0.000000395,-0.000026600,-0.000079921,-0.000040505}};

const float rochcor::dcor_ma_muscle[8][8]={{0.000922114,0.000122016,-0.000104427,-0.000009732,0.000110619,-0.000128943,0.000273161,0.001263345},
					   {0.001397084,0.000242269,-0.000091024,-0.000079004,-0.000059661,-0.000096526,-0.000004115,0.000148291},
					   {0.000467874,0.000214779,0.000028824,0.000058329,-0.000011060,-0.000026892,-0.000044538,0.000047608},
					   {-0.001194958,-0.000255102,0.000090557,0.000021734,0.000018929,-0.000005597,-0.000182582,-0.000049914},
					   {-0.001806358,-0.000171964,0.000164841,-0.000118822,-0.000029894,0.000188520,0.000020351,-0.000665749},
					   {-0.001151867,-0.000165302,0.000084233,-0.000066553,-0.000090629,-0.000026413,-0.000054580,-0.000395975},
					   {0.000368289,0.000062772,0.000121922,0.000011695,-0.000001259,-0.000092503,-0.000136866,0.001151411},
					   {0.000311309,0.000063763,0.000011298,0.000055447,-0.000037567,-0.000181569,-0.000008553,0.001446248}};

const float rochcor::dmavg_muscle[8][8]={{0.025841231,0.025174521,0.025008076,0.025400913,0.025420898,0.025016609,0.025216421,0.025946342},
					 {0.025857748,0.025127432,0.025008648,0.025501019,0.025491937,0.025010914,0.025126947,0.025834595},
					 {0.025821679,0.025184625,0.025040057,0.025499918,0.025484988,0.025037817,0.025108426,0.025777794},
					 {0.025800164,0.025206036,0.025014013,0.025443986,0.025461735,0.025014652,0.025194244,0.025845887},
					 {0.025758598,0.025178983,0.025018260,0.025389631,0.025467834,0.025030688,0.025175725,0.025854529},
					 {0.025806474,0.025167197,0.025042585,0.025454513,0.025447764,0.025030972,0.025151812,0.025817656},
					 {0.025889342,0.025197739,0.025020324,0.025441008,0.025445285,0.025018914,0.025141775,0.025827521},
					 {0.025890673,0.025200190,0.025007315,0.025444507,0.025453018,0.025050532,0.025170505,0.025896777}};

const float rochcor::dpavg_muscle[8][8]={{0.025900314,0.025202461,0.025036367,0.025436674,0.025457142,0.025007727,0.025250309,0.025944332},
					 {0.025878078,0.025129874,0.024985822,0.025499163,0.025485076,0.025017629,0.025155818,0.025882729},
					 {0.025933738,0.025215997,0.025006775,0.025486310,0.025501310,0.025026139,0.025168886,0.025872179},
					 {0.026047407,0.025224788,0.025009424,0.025481826,0.025447529,0.025016264,0.025194307,0.026008481},
					 {0.026042430,0.025232830,0.024979069,0.025451513,0.025447805,0.025040215,0.025228174,0.025979883},
					 {0.025914677,0.025223959,0.025026520,0.025478732,0.025461927,0.025016013,0.025229203,0.025970294},
					 {0.025960950,0.025206106,0.025024689,0.025455858,0.025482325,0.025042175,0.025227654,0.025905506},
					 {0.025918838,0.025238153,0.025036265,0.025464053,0.025451720,0.025010601,0.025207457,0.025872882}};

const float rochcor::dcor_bfer_muscle[8][8]={{0.000071802,0.000036518,0.000031131,0.000029222,0.000029420,0.000031321,0.000037078,0.000068579},
					     {0.000065656,0.000036343,0.000030987,0.000029230,0.000029190,0.000031275,0.000036334,0.000065454},
					     {0.000068104,0.000037416,0.000031188,0.000028989,0.000029033,0.000030926,0.000036456,0.000065954},
					     {0.000066605,0.000036732,0.000030760,0.000029605,0.000029223,0.000031121,0.000036019,0.000065677},
					     {0.000067720,0.000036679,0.000031389,0.000028981,0.000029181,0.000031333,0.000037076,0.000070893},
					     {0.000064982,0.000036052,0.000030579,0.000029931,0.000029535,0.000030845,0.000035972,0.000065730},
					     {0.000067808,0.000036795,0.000030786,0.000029371,0.000029666,0.000030829,0.000036143,0.000066611},
					     {0.000067135,0.000036907,0.000031150,0.000029097,0.000029279,0.000030835,0.000036646,0.000065409}};

const float rochcor::dcor_maer_muscle[8][8]={{0.000071802,0.000036518,0.000031131,0.000029222,0.000029420,0.000031321,0.000037078,0.000068579},
					     {0.000065656,0.000036343,0.000030987,0.000029230,0.000029190,0.000031275,0.000036334,0.000065454},
					     {0.000068104,0.000037416,0.000031188,0.000028989,0.000029033,0.000030926,0.000036456,0.000065954},
					     {0.000066605,0.000036732,0.000030760,0.000029605,0.000029223,0.000031121,0.000036019,0.000065677},
					     {0.000067720,0.000036679,0.000031389,0.000028981,0.000029181,0.000031333,0.000037076,0.000070893},
					     {0.000064982,0.000036052,0.000030579,0.000029931,0.000029535,0.000030845,0.000035972,0.000065730},
					     {0.000067808,0.000036795,0.000030786,0.000029371,0.000029666,0.000030829,0.000036143,0.000066611},
					     {0.000067135,0.000036907,0.000031150,0.000029097,0.000029279,0.000030835,0.000036646,0.000065409}};

//incremental correction on top of SIDRA for data
const float rochcor::dcor_bf_sidra[8][8]={{-0.000045206,0.000070649,0.000154470,0.000019336,0.000070578,0.000112886,0.000027726,-0.000084039},
					  {0.000358091,0.000184729,0.000142152,0.000112973,0.000138713,0.000151069,0.000037241,0.000298778},
					  {0.000130184,0.000073123,0.000105752,0.000146185,0.000176339,0.000080921,0.000041521,0.000117600},
					  {-0.000093494,0.000060535,0.000129229,0.000048616,0.000061764,0.000079158,0.000108676,0.000129550},
					  {0.000074313,0.000103349,0.000161739,0.000142430,0.000121686,0.000035544,0.000015040,0.000174993},
					  {0.000009156,-0.000016388,0.000033833,0.000140176,0.000123313,0.000065975,0.000024130,0.000173172},
					  {-0.000030482,0.000041382,0.000064651,0.000126170,0.000115843,0.000099456,-0.000003935,-0.000048626},
					  {0.000009727,-0.000027629,0.000141885,0.000162052,0.000118496,0.000093372,0.000035268,0.000082222}};

const float rochcor::dcor_ma_sidra[8][8]={{0.000858080,0.000154900,-0.000062584,-0.000091802,0.000042328,-0.000056795,0.000470263,0.001538480},
					  {0.001321130,0.000252569,-0.000055846,-0.000145016,-0.000109998,-0.000029059,0.000177924,0.000414319},
					  {0.000290698,0.000104619,-0.000002724,0.000038498,-0.000017388,0.000022950,0.000092773,0.000272566},
					  {-0.001498510,-0.000485868,-0.000007104,0.000056605,0.000070715,0.000030183,-0.000089235,0.000128929},
					  {-0.002204834,-0.000464339,0.000029122,-0.000050555,0.000053054,0.000216293,0.000092889,-0.000507291},
					  {-0.001520600,-0.000434507,-0.000043468,-0.000017025,-0.000026538,0.000004915,0.000036668,-0.000221410},
					  {0.000117231,-0.000110607,0.000055365,0.000017957,0.000020354,-0.000038578,-0.000010925,0.001369454},
					  {0.000194426,0.000029145,0.000021284,0.000004459,-0.000077443,-0.000120427,0.000168244,0.001702548}};

const float rochcor::dmavg_sidra[8][8]={{0.025820131,0.025168222,0.025007841,0.025390910,0.025413861,0.025009978,0.025225498,0.025976909},
					{0.025859206,0.025121958,0.025003241,0.025497190,0.025484811,0.025007219,0.025130053,0.025839169},
					{0.025819123,0.025160962,0.025034373,0.025492206,0.025477126,0.025033856,0.025107617,0.025776791},
					{0.025791704,0.025182364,0.025007058,0.025437301,0.025452841,0.025006836,0.025182264,0.025849120},
					{0.025738298,0.025172364,0.025007802,0.025385683,0.025467995,0.025023232,0.025175930,0.025847603},
					{0.025782792,0.025146357,0.025030153,0.025449731,0.025442244,0.025022478,0.025150502,0.025816596},
					{0.025880440,0.025175443,0.025013136,0.025432823,0.025443355,0.025015281,0.025134419,0.025837446},
					{0.025889401,0.025191959,0.024997180,0.025438051,0.025444455,0.025044487,0.025177189,0.025882157}};

const float rochcor::dpavg_sidra[8][8]={{0.025892408,0.025195456,0.025022724,0.025435830,0.025455162,0.025002777,0.025237201,0.025935531},
					{0.025857494,0.025118945,0.024969036,0.025496132,0.025482065,0.025004365,0.025142626,0.025871745},
					{0.025923953,0.025209566,0.025000290,0.025481938,0.025492470,0.025023032,0.025154727,0.025865379},
					{0.026034001,0.025228131,0.025002056,0.025478100,0.025435875,0.025008810,0.025182245,0.025977797},
					{0.026049758,0.025230533,0.024973091,0.025443465,0.025437162,0.025035883,0.025215751,0.025954309},
					{0.025937889,0.025221411,0.025025639,0.025472900,0.025458920,0.025010462,0.025217502,0.025954373},
					{0.025957713,0.025205443,0.025019653,0.025448382,0.025475307,0.025033287,0.025218191,0.025899151},
					{0.025921501,0.025229551,0.025026102,0.025461861,0.025444586,0.025005275,0.025183767,0.025869305}};

const float rochcor::dcor_bfer_sidra[8][8]={{0.000071917,0.000036562,0.000031209,0.000029290,0.000029481,0.000031386,0.000037173,0.000068626},
					    {0.000065821,0.000036425,0.000031071,0.000029278,0.000029264,0.000031375,0.000036435,0.000065554},
					    {0.000068213,0.000037505,0.000031270,0.000029048,0.000029107,0.000030985,0.000036575,0.000066006},
					    {0.000066666,0.000036865,0.000030826,0.000029664,0.000029301,0.000031187,0.000036115,0.000065870},
					    {0.000067816,0.000036717,0.000031451,0.000029042,0.000029241,0.000031379,0.000037152,0.000071290},
					    {0.000065160,0.000036126,0.000030664,0.000030003,0.000029577,0.000030891,0.000036074,0.000065849},
					    {0.000068219,0.000036917,0.000030892,0.000029418,0.000029716,0.000030929,0.000036228,0.000066888},
					    {0.000067245,0.000037013,0.000031202,0.000029159,0.000029316,0.000030890,0.000036775,0.000065607}};

const float rochcor::dcor_maer_sidra[8][8]={{0.000071917,0.000036562,0.000031209,0.000029290,0.000029481,0.000031386,0.000037173,0.000068626},
					    {0.000065821,0.000036425,0.000031071,0.000029278,0.000029264,0.000031375,0.000036435,0.000065554},
					    {0.000068213,0.000037505,0.000031270,0.000029048,0.000029107,0.000030985,0.000036575,0.000066006},
					    {0.000066666,0.000036865,0.000030826,0.000029664,0.000029301,0.000031187,0.000036115,0.000065870},
					    {0.000067816,0.000036717,0.000031451,0.000029042,0.000029241,0.000031379,0.000037152,0.000071290},
					    {0.000065160,0.000036126,0.000030664,0.000030003,0.000029577,0.000030891,0.000036074,0.000065849},
					    {0.000068219,0.000036917,0.000030892,0.000029418,0.000029716,0.000030929,0.000036228,0.000066888},
					    {0.000067245,0.000037013,0.000031202,0.000029159,0.000029316,0.000030890,0.000036775,0.000065607}};

//===============================================================================================
//parameters for Z pt correction

const float rochcor::ptlow[85] = {0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0, 5.5,
				  6.0, 6.5, 7.0, 7.5, 8.0, 8.5, 9.0, 9.5,
				  10.0, 10.5, 11.0, 11.5, 12.0, 12.5, 13.0, 13.5, 14.0, 14.5,
				  15.0, 15.5, 16.0, 16.5, 17.0, 17.5, 18.0, 18.5, 19.0, 19.5,
				  20.0, 20.5, 21.0, 21.5, 22.0, 22.5, 23.0, 23.5, 24.0, 24.5,
				  25.0, 26.0, 27.0, 28.0, 29.0,
				  30.0, 32.0, 34.0, 36.0, 38.0,
				  40.0, 44.0, 48.0, 52.0, 56.0,
				  60.0, 65.0, 70.0, 75.0, 80.0, 85.0, 90.0, 95.0,
				  100.0, 110.0, 120.0, 130.0, 140.0, 150.0, 175.0,
				  200.0, 250.0, 350.0, 500.0, 1000.0};

//int nptbins( sizeof(ptlow)/sizeof(float) - 1 );
  
const float rochcor::zptscl[84] = {1.49177,1.45654,1.36283,1.28569,1.2418,1.12336,1.10416,1.08731,0.994051,0.96532,
				   0.94427,0.932725,0.918082,0.899665,0.898398,0.927687,0.908047,0.892392,0.924027,0.945895,
				   0.937149,0.923983,0.923387,0.955362,0.947812,0.962943,0.948781,0.961555,0.95222,0.999207,
				   0.973884,0.993013,0.953487,0.951402,0.985583,0.986603,0.981388,1.00022,1.0294,0.964748,
				   0.974592,1.01546,0.992343,1.00101,0.990866,0.98982,1.02924,1.02265,0.967695,1.02411,
				   0.97331,1.01052,1.01561,0.992594,0.976504,1.01205,0.981111,1.00078,1.02078,1.00719,
				   1.0099,1.02865,1.03845,1.03254,1.09815,1.10263,1.06302,1.0725,1.14703,1.10574,
				   1.13911,1.16947,1.1709,1.11413,1.28793,1.18953,1.20212,1.18112,1.25471,1.15329,
				   1.14276,1.17223,1.09173,2.00229};
  
const float rochcor::zptscler[84] = {0.0270027,0.0154334,0.0115338,0.00958085,0.0084683,0.00736665,0.0069567,0.00671434,
				     0.00617693,0.00601943,0.00594735,0.00594569,0.00594903,0.00595495,0.00608115,0.00633704,
				     0.0063916,0.0064468,0.00678106,0.00706769,0.00717517,0.00727958,0.00747182,0.00785544,
				     0.00798754,0.00828787,0.00839147,0.00865826,0.00876775,0.00933276,0.00935768,0.0097289,
				     0.00962058,0.00983828,0.0103044,0.0104871,0.0106575,0.0110388,0.0114986,0.0111494,
				     0.0115202,0.0121059,0.0121345,0.0124923,0.0125972,0.0128401,0.0134519,0.0136279,
				     0.0133414,0.014186,0.00992195,0.0105984,0.0109484,0.0111756,0.0114579,0.00870013,
				     0.00904749,0.00970734,0.0104583,0.0109818,0.00837852,0.00939894,0.010415,0.0113433,
				     0.013007,0.0128788,0.0140174,0.0156993,0.0181717,0.019765,0.0222326,0.0249408,
				     0.0272806,0.0211706,0.0278087,0.0306654,0.0361387,0.041327,0.0341513,0.0440116,
				     0.0473006,0.0680212,0.149162,0.56279};

//static float dsys[8][8];
//static float msys[8][8];

rochcor::~rochcor(){
}

rochcor::rochcor(){
  
//  eran1.SetSeed(123456);
//  eran2.SetSeed(234567);
  eran1.SetSeed();
  eran2.SetSeed(eran1.GetSeed()+1111);
  
//  sran1.SetSeed(1234);
//  sran2.SetSeed(2345);
  sran1.SetSeed(eran1.GetSeed()+2222);
  sran2.SetSeed(eran1.GetSeed()+3333);
 /*
std::cout << 
"\teran1.GetSeed()= " << eran1.GetSeed() <<
"\teran2.GetSeed()= " << eran2.GetSeed() <<
"\tsran1.GetSeed()= " << sran1.GetSeed() <<
"\tsran2.GetSeed()= " << sran2.GetSeed() <<
std::endl;
*/ 
  /*
  for(int i=0; i<8; i++){
    for(int j=0; j<8; j++){
      dsys[i][j] = float(sran1.Integer(3))-1.0;
      msys[i][j] = float(sran2.Integer(3))-1.0;
    }
  }
  */

}

void rochcor::momcor_mc( TLorentzVector& mu, TLorentzVector& mubar, int moption, float sysdev){
  
  //sysdev == num : deviation = num

  float ptmu = mu.Pt();
  float ptmub = mubar.Pt();

  float muphi = mu.Phi();
  float mueta = mu.Eta(); // same with mu.Eta() in Root

  float mubphi = mubar.Phi();
  float mubeta = mubar.Eta();

  float px1 = mu.Px();
  float py1 = mu.Py();
  float pz1 = mu.Pz();
  float e1 = mu.E();

  float px2 = mubar.Px();
  float py2 = mubar.Py();
  float pz2 = mubar.Pz();
  float e2 = mubar.E();
  
  int mu_phibin = phibin(muphi);
  int mu_etabin = etabin(mueta);

  int mub_phibin = phibin(mubphi);
  int mub_etabin = etabin(mubeta);
  
  float mptsys1 = sran1.Gaus(0.0,sysdev);
  float mptsys2 = sran2.Gaus(0.0,sysdev);
  
  float dm1 = mcor_bf[mu_phibin][mu_etabin] + mptsys1*mcor_bfer[mu_phibin][mu_etabin];
  float da1 = mcor_ma[mu_phibin][mu_etabin] + mptsys1*mcor_maer[mu_phibin][mu_etabin];
  
  float dm2 = mcor_bf[mub_phibin][mub_etabin] + mptsys2*mcor_bfer[mub_phibin][mub_etabin];
  float da2 = mcor_ma[mub_phibin][mub_etabin] + mptsys2*mcor_maer[mub_phibin][mub_etabin];
  
  float cor1 = 1.0/(1.0 + dm1/mmavg[mu_phibin][mu_etabin] - da1*ptmu);
  float cor2 = 1.0/(1.0 + dm2/mpavg[mu_phibin][mu_etabin] + da2*ptmub);
  
  //for the momentum tuning - eta,phi,Q correction
  px1 *= cor1;
  py1 *= cor1;
  pz1 *= cor1;
  e1 *= cor1;
  
  px2 *= cor2;
  py2 *= cor2;
  pz2 *= cor2;
  e2 *= cor2;
    
  float tune1 = 1.0/(1.0 + delta*sqrt(px1*px1 + py1*py1)*eran1.Gaus(1.0,sf));
  float tune2 = 1.0/(1.0 + delta*sqrt(px2*px2 + py2*py2)*eran2.Gaus(1.0,sf));
  
  px1 *= (tune1); 
  py1 *= (tune1);  
  pz1 *= (tune1);  
  e1 *= (tune1);   
  
  px2 *= (tune2); 
  py2 *= (tune2);  
  pz2 *= (tune2);  
  e2 *= (tune2);   
  
  float genm_smr = 9.09956e+01; //gen mass peak with eta dependent gaussian smearing => better match in Z mass profile vs. eta/phi
  float genm = 91.06; //gen mass peak without smearing => Z mass profile vs. eta/phi in CMS note
  float recm = 9.09972e+01; //rec mass peak in MC
  float drecm = 9.09099e+01; //rec mass peak in data
  
  float gscl = 1.0;
  if(moption==0) gscl = (genm/recm);
  else if(moption==1) gscl = (genm_smr/recm);
  else if(moption==2) gscl = (drecm/recm);
  
  px1 *= gscl;
  py1 *= gscl;
  pz1 *= gscl;
  e1 *= gscl;
  
  px2 *= gscl;
  py2 *= gscl;
  pz2 *= gscl;
  e2 *= gscl;
    
  mu.SetPxPyPzE(px1,py1,pz1,e1);
  mubar.SetPxPyPzE(px2,py2,pz2,e2);
  
}


void rochcor::momcor_data( TLorentzVector& mu, TLorentzVector& mubar, int moption, float sysdev){
    
  float ptmu = mu.Pt();
  float ptmub = mubar.Pt();

  float muphi = mu.Phi();
  float mueta = mu.Eta(); // same with mu.Eta() in Root

  float mubphi = mubar.Phi();
  float mubeta = mubar.Eta();

  float px1 = mu.Px();
  float py1 = mu.Py();
  float pz1 = mu.Pz();
  float e1 = mu.E();
  
  float px2 = mubar.Px();
  float py2 = mubar.Py();
  float pz2 = mubar.Pz();
  float e2 = mubar.E();
  
  int mu_phibin = phibin(muphi);
  int mu_etabin = etabin(mueta);

  int mub_phibin = phibin(mubphi);
  int mub_etabin = etabin(mubeta);
  
  float mptsys1 = sran1.Gaus(0.0,sysdev);
  float mptsys2 = sran2.Gaus(0.0,sysdev);
  
  float dm1 = dcor_bf[mu_phibin][mu_etabin] + mptsys1*dcor_bfer[mu_phibin][mu_etabin];
  float da1 = dcor_ma[mu_phibin][mu_etabin] + mptsys1*dcor_maer[mu_phibin][mu_etabin];
  
  float dm2 = dcor_bf[mub_phibin][mub_etabin] + mptsys2*dcor_bfer[mub_phibin][mub_etabin];
  float da2 = dcor_ma[mub_phibin][mub_etabin] + mptsys2*dcor_maer[mub_phibin][mub_etabin];
  
  float cor1 = 1.0/(1.0 + dm1/dmavg[mu_phibin][mu_etabin] - da1*ptmu);
  float cor2 = 1.0/(1.0 + dm2/dpavg[mu_phibin][mu_etabin] + da2*ptmub);
  
  px1 *= cor1;
  py1 *= cor1;
  pz1 *= cor1;
  e1 *= cor1;
  
  px2 *= cor2;
  py2 *= cor2;
  pz2 *= cor2;
  e2 *= cor2;
  
  //after Z pt correction
  float genm_smr = 9.09956e+01; //gen mass peak with eta dependent gaussian smearing => better match in Z mass profile vs. eta/phi
  float genm = 91.06; //gen mass peak without smearing => Z mass profile vs. eta/phi in CMS note
  float recm = 9.09099e+01; //rec mass peak in data
  
  float gscl = 1.0;
  if(moption==0) gscl = (genm/recm);
  else if(moption==1) gscl = (genm_smr/recm);
  else if(moption==2) gscl = 1.0;
  
  px1 *= gscl;
  py1 *= gscl;
  pz1 *= gscl;
  e1 *= gscl;
  
  px2 *= gscl;
  py2 *= gscl;
  pz2 *= gscl;
  e2 *= gscl;
  
  mu.SetPxPyPzE(px1,py1,pz1,e1);
  mubar.SetPxPyPzE(px2,py2,pz2,e2);

}

void rochcor::momcor_mc_muscle( TLorentzVector& mu, TLorentzVector& mubar, int moption, float sysdev){
  
  //sysdev == num : deviation = num

  float ptmu = mu.Pt();
  float ptmub = mubar.Pt();

  float muphi = mu.Phi();
  float mueta = mu.Eta(); // same with mu.Eta() in Root

  float mubphi = mubar.Phi();
  float mubeta = mubar.Eta();

  float px1 = mu.Px();
  float py1 = mu.Py();
  float pz1 = mu.Pz();
  float e1 = mu.E();

  float px2 = mubar.Px();
  float py2 = mubar.Py();
  float pz2 = mubar.Pz();
  float e2 = mubar.E();
  
  int mu_phibin = phibin(muphi);
  int mu_etabin = etabin(mueta);

  int mub_phibin = phibin(mubphi);
  int mub_etabin = etabin(mubeta);
  
  float mptsys1 = sran1.Gaus(0.0,sysdev);
  float mptsys2 = sran2.Gaus(0.0,sysdev);
  
  float dm1 = mcor_bf[mu_phibin][mu_etabin] + mptsys1*mcor_bfer[mu_phibin][mu_etabin];
  float da1 = mcor_ma[mu_phibin][mu_etabin] + mptsys1*mcor_maer[mu_phibin][mu_etabin];
  
  float dm2 = mcor_bf[mub_phibin][mub_etabin] + mptsys2*mcor_bfer[mub_phibin][mub_etabin];
  float da2 = mcor_ma[mub_phibin][mub_etabin] + mptsys2*mcor_maer[mub_phibin][mub_etabin];
  
  float cor1 = 1.0/(1.0 + dm1/mmavg[mu_phibin][mu_etabin] - da1*ptmu);
  float cor2 = 1.0/(1.0 + dm2/mpavg[mu_phibin][mu_etabin] + da2*ptmub);
  
  //for the momentum tuning - eta,phi,Q correction
  px1 *= cor1;
  py1 *= cor1;
  pz1 *= cor1;
  e1 *= cor1;
  
  px2 *= cor2;
  py2 *= cor2;
  pz2 *= cor2;
  e2 *= cor2;
    
  float tune1 = 1.0/(1.0 + delta_muscle*sqrt(px1*px1 + py1*py1)*eran1.Gaus(1.0,sf_muscle));
  float tune2 = 1.0/(1.0 + delta_muscle*sqrt(px2*px2 + py2*py2)*eran2.Gaus(1.0,sf_muscle));
  
  px1 *= (tune1); 
  py1 *= (tune1);  
  pz1 *= (tune1);  
  e1 *= (tune1);   
  
  px2 *= (tune2); 
  py2 *= (tune2);  
  pz2 *= (tune2);  
  e2 *= (tune2);   
  
  float genm_smr = 9.09956e+01; //gen mass peak with eta dependent gaussian smearing => better match in Z mass profile vs. eta/phi
  float genm = 91.06; //gen mass peak without smearing => Z mass profile vs. eta/phi in CMS note
  float recm = 9.09972e+01; //rec mass peak in MC
  float drecm = 9.09109e+01; //rec mass peak in data
  
  float gscl = 1.0;
  if(moption==0) gscl = (genm/recm);
  else if(moption==1) gscl = (genm_smr/recm);
  else if(moption==2) gscl = (drecm/recm);
  
  px1 *= gscl;
  py1 *= gscl;
  pz1 *= gscl;
  e1 *= gscl;
  
  px2 *= gscl;
  py2 *= gscl;
  pz2 *= gscl;
  e2 *= gscl;
    
  mu.SetPxPyPzE(px1,py1,pz1,e1);
  mubar.SetPxPyPzE(px2,py2,pz2,e2);
  
}


void rochcor::momcor_data_muscle( TLorentzVector& mu, TLorentzVector& mubar, int moption, float sysdev){
    
  float ptmu = mu.Pt();
  float ptmub = mubar.Pt();

  float muphi = mu.Phi();
  float mueta = mu.Eta(); // same with mu.Eta() in Root

  float mubphi = mubar.Phi();
  float mubeta = mubar.Eta();

  float px1 = mu.Px();
  float py1 = mu.Py();
  float pz1 = mu.Pz();
  float e1 = mu.E();
  
  float px2 = mubar.Px();
  float py2 = mubar.Py();
  float pz2 = mubar.Pz();
  float e2 = mubar.E();
  
  int mu_phibin = phibin(muphi);
  int mu_etabin = etabin(mueta);

  int mub_phibin = phibin(mubphi);
  int mub_etabin = etabin(mubeta);
  
  float mptsys1 = sran1.Gaus(0.0,sysdev);
  float mptsys2 = sran2.Gaus(0.0,sysdev);
  
  float dm1 = dcor_bf_muscle[mu_phibin][mu_etabin] + mptsys1*dcor_bfer_muscle[mu_phibin][mu_etabin];
  float da1 = dcor_ma_muscle[mu_phibin][mu_etabin] + mptsys1*dcor_maer_muscle[mu_phibin][mu_etabin];
  
  float dm2 = dcor_bf_muscle[mub_phibin][mub_etabin] + mptsys2*dcor_bfer_muscle[mub_phibin][mub_etabin];
  float da2 = dcor_ma_muscle[mub_phibin][mub_etabin] + mptsys2*dcor_maer_muscle[mub_phibin][mub_etabin];
  
  float cor1 = 1.0/(1.0 + dm1/dmavg_muscle[mu_phibin][mu_etabin] - da1*ptmu);
  float cor2 = 1.0/(1.0 + dm2/dpavg_muscle[mu_phibin][mu_etabin] + da2*ptmub);
  
  px1 *= cor1;
  py1 *= cor1;
  pz1 *= cor1;
  e1 *= cor1;
  
  px2 *= cor2;
  py2 *= cor2;
  pz2 *= cor2;
  e2 *= cor2;
  
  //after Z pt correction
  float genm_smr = 9.09956e+01; //gen mass peak with eta dependent gaussian smearing => better match in Z mass profile vs. eta/phi
  float genm = 91.06; //gen mass peak without smearing => Z mass profile vs. eta/phi in CMS note
  float recm = 9.09109e+01; //rec mass peak in data
  
  float gscl = 1.0;
  if(moption==0) gscl = (genm/recm);
  else if(moption==1) gscl = (genm_smr/recm);
  else if(moption==2) gscl = 1.0;
  
  px1 *= gscl;
  py1 *= gscl;
  pz1 *= gscl;
  e1 *= gscl;
  
  px2 *= gscl;
  py2 *= gscl;
  pz2 *= gscl;
  e2 *= gscl;
  
  mu.SetPxPyPzE(px1,py1,pz1,e1);
  mubar.SetPxPyPzE(px2,py2,pz2,e2);

}

void rochcor::momcor_mc_sidra( TLorentzVector& mu, TLorentzVector& mubar, int moption, float sysdev){
  
  //sysdev == num : deviation = num

  float ptmu = mu.Pt();
  float ptmub = mubar.Pt();

  float muphi = mu.Phi();
  float mueta = mu.Eta(); // same with mu.Eta() in Root

  float mubphi = mubar.Phi();
  float mubeta = mubar.Eta();

  float px1 = mu.Px();
  float py1 = mu.Py();
  float pz1 = mu.Pz();
  float e1 = mu.E();

  float px2 = mubar.Px();
  float py2 = mubar.Py();
  float pz2 = mubar.Pz();
  float e2 = mubar.E();
  
  int mu_phibin = phibin(muphi);
  int mu_etabin = etabin(mueta);

  int mub_phibin = phibin(mubphi);
  int mub_etabin = etabin(mubeta);
  
  float mptsys1 = sran1.Gaus(0.0,sysdev);
  float mptsys2 = sran2.Gaus(0.0,sysdev);
  
  float dm1 = mcor_bf[mu_phibin][mu_etabin] + mptsys1*mcor_bfer[mu_phibin][mu_etabin];
  float da1 = mcor_ma[mu_phibin][mu_etabin] + mptsys1*mcor_maer[mu_phibin][mu_etabin];
  
  float dm2 = mcor_bf[mub_phibin][mub_etabin] + mptsys2*mcor_bfer[mub_phibin][mub_etabin];
  float da2 = mcor_ma[mub_phibin][mub_etabin] + mptsys2*mcor_maer[mub_phibin][mub_etabin];
  
  float cor1 = 1.0/(1.0 + dm1/mmavg[mu_phibin][mu_etabin] - da1*ptmu);
  float cor2 = 1.0/(1.0 + dm2/mpavg[mu_phibin][mu_etabin] + da2*ptmub);
  
  //for the momentum tuning - eta,phi,Q correction
  px1 *= cor1;
  py1 *= cor1;
  pz1 *= cor1;
  e1 *= cor1;
  
  px2 *= cor2;
  py2 *= cor2;
  pz2 *= cor2;
  e2 *= cor2;
    
  float tune1 = 1.0/(1.0 + delta_sidra*sqrt(px1*px1 + py1*py1)*eran1.Gaus(1.0,sf_sidra));
  float tune2 = 1.0/(1.0 + delta_sidra*sqrt(px2*px2 + py2*py2)*eran2.Gaus(1.0,sf_sidra));
  
  px1 *= (tune1); 
  py1 *= (tune1);  
  pz1 *= (tune1);  
  e1 *= (tune1);   
  
  px2 *= (tune2); 
  py2 *= (tune2);  
  pz2 *= (tune2);  
  e2 *= (tune2);   
  
  float genm_smr = 9.09956e+01; //gen mass peak with eta dependent gaussian smearing => better match in Z mass profile vs. eta/phi
  float genm = 91.06; //gen mass peak without smearing => Z mass profile vs. eta/phi in CMS note
  float recm = 9.09972e+01; //rec mass peak in MC
  float drecm = 9.08884e+01; //rec mass peak in data
  
  float gscl = 1.0;
  if(moption==0) gscl = (genm/recm);
  else if(moption==1) gscl = (genm_smr/recm);
  else if(moption==2) gscl = (drecm/recm);
  
  px1 *= gscl;
  py1 *= gscl;
  pz1 *= gscl;
  e1 *= gscl;
  
  px2 *= gscl;
  py2 *= gscl;
  pz2 *= gscl;
  e2 *= gscl;
    
  mu.SetPxPyPzE(px1,py1,pz1,e1);
  mubar.SetPxPyPzE(px2,py2,pz2,e2);
  
}


void rochcor::momcor_data_sidra( TLorentzVector& mu, TLorentzVector& mubar, int moption, float sysdev){
    
  float ptmu = mu.Pt();
  float ptmub = mubar.Pt();

  float muphi = mu.Phi();
  float mueta = mu.Eta(); // same with mu.Eta() in Root

  float mubphi = mubar.Phi();
  float mubeta = mubar.Eta();

  float px1 = mu.Px();
  float py1 = mu.Py();
  float pz1 = mu.Pz();
  float e1 = mu.E();
  
  float px2 = mubar.Px();
  float py2 = mubar.Py();
  float pz2 = mubar.Pz();
  float e2 = mubar.E();
  
  int mu_phibin = phibin(muphi);
  int mu_etabin = etabin(mueta);

  int mub_phibin = phibin(mubphi);
  int mub_etabin = etabin(mubeta);
  
  float mptsys1 = sran1.Gaus(0.0,sysdev);
  float mptsys2 = sran2.Gaus(0.0,sysdev);
  
  float dm1 = dcor_bf_sidra[mu_phibin][mu_etabin] + mptsys1*dcor_bfer_sidra[mu_phibin][mu_etabin];
  float da1 = dcor_ma_sidra[mu_phibin][mu_etabin] + mptsys1*dcor_maer_sidra[mu_phibin][mu_etabin];
  
  float dm2 = dcor_bf_sidra[mub_phibin][mub_etabin] + mptsys2*dcor_bfer_sidra[mub_phibin][mub_etabin];
  float da2 = dcor_ma_sidra[mub_phibin][mub_etabin] + mptsys2*dcor_maer_sidra[mub_phibin][mub_etabin];
  
  float cor1 = 1.0/(1.0 + dm1/dmavg_sidra[mu_phibin][mu_etabin] - da1*ptmu);
  float cor2 = 1.0/(1.0 + dm2/dpavg_sidra[mu_phibin][mu_etabin] + da2*ptmub);
  
  px1 *= cor1;
  py1 *= cor1;
  pz1 *= cor1;
  e1 *= cor1;
  
  px2 *= cor2;
  py2 *= cor2;
  pz2 *= cor2;
  e2 *= cor2;
  
  //after Z pt correction
  float genm_smr = 9.09956e+01; //gen mass peak with eta dependent gaussian smearing => better match in Z mass profile vs. eta/phi
  float genm = 91.06; //gen mass peak without smearing => Z mass profile vs. eta/phi in CMS note
  float recm = 9.08884e+01; //rec mass peak in data
  
  float gscl = 1.0;
  if(moption==0) gscl = (genm/recm);
  else if(moption==1) gscl = (genm_smr/recm);
  else if(moption==2) gscl = 1.0;
  
  px1 *= gscl;
  py1 *= gscl;
  pz1 *= gscl;
  e1 *= gscl;
  
  px2 *= gscl;
  py2 *= gscl;
  pz2 *= gscl;
  e2 *= gscl;
  
  mu.SetPxPyPzE(px1,py1,pz1,e1);
  mubar.SetPxPyPzE(px2,py2,pz2,e2);

}

void rochcor::musclefit_data( TLorentzVector& mu, TLorentzVector& mubar){

  float dpar1 = 0.0;
  float dpar2 = 0.0;
  float epar1 = 0.0;
  float epar2 = 0.0;
  
  if(fabs(mu.PseudoRapidity())<=0.9){
    dpar1 = d0par;
    epar1 = e0par;
  }else if(mu.PseudoRapidity()>0.9){
    dpar1 = d1par;
    epar1 = e1par;
  }else if(mu.PseudoRapidity()<-0.9){
    dpar1 = d2par;
    epar1 = e2par;
  }

  if(fabs(mubar.PseudoRapidity())<=0.9){
    dpar2 = d0par;
    epar2 = e0par;
  }else if(mubar.PseudoRapidity()>0.9){
    dpar2 = d1par;
    epar2 = e1par;
  }else if(mubar.PseudoRapidity()<-0.9){
    dpar2 = d2par;
    epar2 = e2par;
  }

  float corr1 = 1.0 + bpar*mu.Pt() + (-1.0)*cpar*mu.Pt()*TMath::Sign(float(1.0),float(mu.PseudoRapidity()))*TMath::Power(mu.PseudoRapidity(),2)
    + (-1.0)*dpar1*mu.Pt()*sin(mu.Phi() + epar1);
  float corr2 = 1.0 + bpar*mubar.Pt() + (1.0)*cpar*mubar.Pt()*TMath::Sign(float(1.0),float(mubar.PseudoRapidity()))*TMath::Power(mubar.PseudoRapidity(),2)
    + (1.0)*dpar2*mubar.Pt()*sin(mubar.Phi() + epar2);
  
  float px1 = mu.Px();
  float py1 = mu.Py();
  float pz1 = mu.Pz();
  float e1 = mu.E();
  
  float px2 = mubar.Px();
  float py2 = mubar.Py();
  float pz2 = mubar.Pz();
  float e2 = mubar.E();

  px1 *= corr1;
  py1 *= corr1;
  pz1 *= corr1;
  e1 *= corr1;
  
  px2 *= corr2;
  py2 *= corr2;
  pz2 *= corr2;
  e2 *= corr2;
  
  mu.SetPxPyPzE(px1,py1,pz1,e1);
  mubar.SetPxPyPzE(px2,py2,pz2,e2);

}

Int_t rochcor::phibin(float phi){
  
  int nphibin = -1;
  
  for(int i=0; i<8; i++){
//    if(-pi+(2.0*pi/8.0)*i <= phi && -pi+(2.0*pi/8.0)*(i+1) > phi){
    if(-(double)(pi)+(2.0 * (double)(pi)/8.0)*i <= phi && -(double)(pi)+(2.0*(double)(pi)/8.0)*(i+1) > phi){
      nphibin = i;
      break;
    }
  }
  
  return nphibin;
}

Int_t rochcor::etabin(float eta){

  int nbin = -1;
  
  for(int i=0; i<8; i++){
    if(netabin[i] <= eta && netabin[i+1] > eta){
      nbin = i;
      break;
    }
  }
  
  return nbin;
}

float rochcor::zptcor(float gzpt) {
  int ibin( 0 );
  
  // mcptscl[] = 84 bins: [0] and [83] are the underflow and overflow
  if ( gzpt > ptlow[nptbins] ) return nptbins-1;
  if ( gzpt < ptlow[0      ] ) return 0;
  
  for ( int i=0; i<nptbins; ++i ) {
    if ( gzpt>=ptlow[i] && gzpt<ptlow[i+1] ) { ibin=i; break; }
  }

  float zptwt = zptscl[ibin];

  return zptwt;
}
